<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>URL Shortener</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      margin-bottom: 10px;
      width: 100%;
      font-size: 16px;
    }
    .result {
      margin-top: 20px;
    }
    .link-box {
      margin-bottom: 10px;
      background: #f1f1f1;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>URL Shortener</h1>
  <form id="form">
    <input type="text" id="url" placeholder="Paste your long URL" required />
    <input type="text" id="custom" placeholder="Custom alias (optional)" />
    <button type="submit">Shorten</button>
  </form>

  <div id="result" class="result"></div>

  <script>
    const form = document.getElementById('form');
    const resultDiv = document.getElementById('result');

    const savedLinks = JSON.parse(localStorage.getItem('shortLinks')) || [];

    function renderLinks() {
      resultDiv.innerHTML = '';
      savedLinks.forEach(link => {
        const div = document.createElement('div');
        div.className = 'link-box';
        div.innerHTML = `<a href="${link.url}" target="_blank">${link.url}</a> - Clicks: <span id="click-${link.id}">${link.clicks || 0}</span>`;
        resultDiv.appendChild(div);
      });
    }

    renderLinks();

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const url = document.getElementById('url').value;
      const custom = document.getElementById('custom').value;

      const res = await fetch('/api/shorten', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url, custom })
      });

      const data = await res.json();

      if (data.error) {
        alert(data.error);
        return;
      }

      const newLink = { url: data.shortened_url, id: data.id, clicks: 0 };
      savedLinks.push(newLink);
      localStorage.setItem('shortLinks', JSON.stringify(savedLinks));
      renderLinks();
    });
  </script>
</body>
</html>
