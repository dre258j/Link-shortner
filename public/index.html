<!DOCTYPE html>
<html>
<head>
  <title>Shortener</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    input, button { padding: 10px; margin: 5px; width: 300px; }
    .link-row { margin: 10px 0; }
  </style>
</head>
<body>
  <h2>ðŸ”— Custom URL Shortener</h2>
  <input id="urlInput" placeholder="Enter long URL"><br>
  <input id="customInput" placeholder="Custom alias (optional)"><br>
  <button onclick="shorten()">Shorten</button>

  <div id="result"></div>
  <h3>ðŸ“Š Your Links</h3>
  <div id="history"></div>

  <script>
    const shorten = async () => {
      const url = document.getElementById("urlInput").value;
      const custom = document.getElementById("customInput").value;

      const res = await fetch('/api/shorten', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url, custom })
      });

      const data = await res.json();

      if (data.error) {
        document.getElementById("result").innerText = data.error;
      } else {
        const shortUrl = data.shortened_url;
        saveLink(shortUrl);
        displayLinks();
      }
    };

    const saveLink = (url) => {
      let links = JSON.parse(localStorage.getItem("shortLinks")) || {};
      if (!links[url]) links[url] = 0;
      localStorage.setItem("shortLinks", JSON.stringify(links));
    };

    const displayLinks = () => {
      const links = JSON.parse(localStorage.getItem("shortLinks")) || {};
      const container = document.getElementById("history");
      container.innerHTML = '';

      Object.entries(links).forEach(([link, count]) => {
        const div = document.createElement("div");
        div.className = "link-row";
        div.innerHTML = `<a href="${link}" target="_blank" onclick="increment('${link}')">${link}</a> - Clicks: ${count}`;
        container.appendChild(div);
      });
    };

    const increment = (url) => {
      const links = JSON.parse(localStorage.getItem("shortLinks")) || {};
      links[url] = (links[url] || 0) + 1;
      localStorage.setItem("shortLinks", JSON.stringify(links));
    };

    window.onload = displayLinks;
  </script>
</body>
</html>
